{% extends "base.html" %}

{% block title %}–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞: {{ query }} - –¢–æ–ª—Å—Ç–æ–π Search{% endblock %}

{% block content %}
<div class="container">
    <div class="search-header">
        <form action="{{ url_for('search') }}" method="get" class="search-form-inline">
            <input type="text" name="q" value="{{ query }}" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å..." required>
            <select name="type">
                <option value="passages" {% if search_type == 'passages' %}selected{% endif %}>–ü–æ–∏—Å–∫ –æ—Ç—Ä—ã–≤–∫–æ–≤</option>
                <option value="works" {% if search_type == 'works' %}selected{% endif %}>–ü–æ–∏—Å–∫ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–π</option>
            </select>
            <button type="submit">–ü–æ–∏—Å–∫</button>
        </form>
        <p class="results-count">
            {% if search_type == 'passages' %}
                –ù–∞–π–¥–µ–Ω–æ –æ—Ç—Ä—ã–≤–∫–æ–≤: {{ results|length }}
            {% else %}
                –ù–∞–π–¥–µ–Ω–æ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–π: {{ results|length }}
            {% endif %}
        </p>
    </div>

    {% if results %}
        {% if search_type == 'passages' %}
            <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –ø–æ –æ—Ç—Ä—ã–≤–∫–∞–º -->
            <div class="passages-results">
                {% for result in results %}
                <div class="passage-card">
                    <div class="similarity-badge">{{ "%.1f"|format(result.similarity_percent) }}%</div>
                    
                    <div class="passage-header">
                        <h3>
                            <a href="{{ result.work_url }}" target="_blank">{{ result.work_title }}</a>
                        </h3>
                        <div class="passage-meta">
                            <span>üìè {{ result.word_count }} —Å–ª–æ–≤</span>
                            <span>üéØ –°—Ö–æ–∂–µ—Å—Ç—å: {{ "%.1f"|format(result.similarity_percent) }}%</span>
                        </div>
                    </div>
                    
                        <div class="passage-content">
                        <blockquote>
                            {{ result.passage|safe }}
                        </blockquote>
                        {% if result.has_highlight %}
                        <div class="highlight-note">
                            <small>üîç –í—ã–¥–µ–ª–µ–Ω—ã –Ω–∞–∏–±–æ–ª–µ–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —á–∞—Å—Ç–∏</small>
                        </div>
                        {% endif %}
                    </div>
                                        
                    <div class="passage-actions">
                        <a href="{{ result.work_url }}" target="_blank" class="btn">–ß–∏—Ç–∞—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é</a>
                        <a href="{{ url_for('work_detail', work_id=result.work_id) }}" class="btn btn-secondary">–û –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–∏</a>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –ø–æ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è–º (—Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç) -->
            <div class="results-grid">
                {% for result in results %}
                <div class="result-card">
                    <div class="similarity-badge">{{ "%.1f"|format(result.similarity_percent) }}%</div>
                    <h3><a href="{{ result.url }}" target="_blank">{{ result.title }}</a></h3>
                    <div class="result-meta">
                        <span>üìè {{ result.original_length }} —Ç–æ–∫–µ–Ω–æ–≤</span>
                        <span>üî¢ {{ result.num_chunks }} —á–∞—Å—Ç–µ–π</span>
                    </div>
                    <div class="result-actions">
                        <a href="{{ result.url }}" target="_blank" class="btn">–ß–∏—Ç–∞—Ç—å</a>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% endif %}
    {% else %}
        <div class="no-results">
            <h2>–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h2>
            <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞</p>
        </div>
    {% endif %}
</div>
{% endblock %}
